import { Message } from "@/src/constants/types/ai_chat";

export function buildPrompt(
  slidePrompt: string,
  isFirstMessage: boolean,
  lastUserMessage?: Message,
  criteriasText: string = ""
): string {
  let content = "";

  if (isFirstMessage) {
    content = `–í—ñ–∑—å–º–∏ —Ç–µ–∫—Å—Ç –ø—ñ—Å–ª—è —Å–ª–æ–≤–∞ "–ö–ï–ô–°:" —É —Ü—å–æ–º—É –æ–ø–∏—Å—ñ:
${slidePrompt}

–ü–æ–∫–∞–∂–∏ –π–æ–≥–æ –±–µ–∑ —Å–ª–æ–≤–∞ "–ö–ï–ô–°:" —ñ –±–µ–∑ –ª–∞–ø–æ–∫. 
–ù–µ –¥–æ–¥–∞–≤–∞–π –Ω—ñ—á–æ–≥–æ –≤—ñ–¥ —Å–µ–±–µ.`;
    return content;
  }

  if (lastUserMessage?.text) {
    const studentAnswer = lastUserMessage.text;

    const strictFormat = `–û—Ü—ñ–Ω–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –∑–∞ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º–∏ –∑ —Ü—å–æ–≥–æ –æ–ø–∏—Å—É:
    ${slidePrompt}
    
    –í—ñ–¥–ø–æ–≤—ñ–¥—å —Å—Ç—É–¥–µ–Ω—Ç–∞:
    ${studentAnswer}
    
    –¢–µ–ø–µ—Ä –ø–æ–≤–µ—Ä–Ω–∏ –°–¢–†–û–ì–û –≤–∞–ª—ñ–¥–Ω–∏–π JSON –≤ –æ–¥–∏–Ω —Ä—è–¥–æ–∫ –±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å—ñ–≤ —Ä—è–¥–∫—ñ–≤, –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç—É. –§–æ—Ä–º–∞—Ç:
    
    {
      "text": "–ø–æ–≤—Ç–æ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Å—Ç—É–¥–µ–Ω—Ç–∞",
      "rating": {
        "overall_score": <—á–∏—Å–ª–æ –≤—ñ–¥ 0 –¥–æ 10>,
        "criteriaScores": {
          "–¥–ª—è —Ç–æ–≥–æ —â–æ–± –∑—Ä–æ–∑—É–º—ñ—Ç–∏ —è–∫–∏–π –±—É–¥–µ –∫–ª—é—á –∑–Ω–∞–π—Ç–∏ –Ω–∞–∑–≤—É –∫—Ä–∏—Ç–µ—Ä–∏—é –≤ —Å–ø–∏—Å–∫—É ${criteriasText}, —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤—É –∫–ª—é—á": <–æ—Ü—ñ–Ω–∫–∞>,
          "...": <–æ—Ü—ñ–Ω–∫–∞>
        },
        "comment":"üìä –ó–ê–ì–ê–õ–¨–ù–ê –û–¶–Ü–ù–ö–ê: 8/10\n\nüéØ –û–¶–Ü–ù–ö–ê –ü–û –ö–†–ò–¢–ï–†–Ü–Ø–•:\n‚Ä¢ –õ–æ–≥—ñ–∫–∞: 7\n‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞: 8\n\nüí° –§–Ü–î–ë–ï–ö:\n–¢—É—Ç –π–¥–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è...\n\n‚úÖ –°–ò–õ–¨–ù–Ü –°–¢–û–†–û–ù–ò:\n...\n\nüîß –©–û –ü–û–ö–†–ê–©–ò–¢–ò:\n...\n\nüöÄ –ù–ê–°–¢–£–ü–ù–ò–ô –ö–†–û–ö:\n..."
      }
    }
    
    ‚ùó –î—É–∂–µ –≤–∞–∂–ª–∏–≤–æ: —Ü–µ –º–∞—î –±—É—Ç–∏ –û–î–ò–ù JSON-–æ–± º—î–∫—Ç, –±–µ–∑ –∑–∞–π–≤–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω—å, –±–µ–∑ \\n —É—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä—è–¥–∫–∞. –ê–±–∑–∞—Ü–∏ —Ñ–æ—Ä–º—É–π –ª–∏—à–µ –ø—Ä–æ–±—ñ–ª–∞–º–∏ –∞–±–æ –º–∞—Ä–∫–µ—Ä–∞–º–∏ (‚Ä¢), –∞–ª–µ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π —Ä–µ–∞–ª—å–Ω—ñ –ø–µ—Ä–µ–Ω–æ—Å–∏ —Ä—è–¥–∫—ñ–≤.`;
    

    return strictFormat;
  }

  return "";
}
