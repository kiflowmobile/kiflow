import { Message } from '@/src/constants/types/ai_chat';


export function buildPrompt(
  slidePrompt: string,
  isFirstMessage: boolean,
  lastUserMessage?: Message,
  criteriasText: string = '',
  companyStandards?: unknown,
): string {
  const standardsInstruction = companyStandards
    ? `
    –¢–∏ ‚Äî –µ–∫—Å–ø–µ—Ä—Ç —ñ–∑ –≤–∏—Å–æ–∫–æ—Ä—ñ–≤–Ω–µ–≤–∏—Ö –ø—Ä–æ–¥–∞–∂—ñ–≤ –º–µ–±–ª—ñ–≤ —ñ —Å–µ—Ä–≤—ñ—Å–Ω–æ—ó –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó –∫–æ–º–ø–∞–Ω—ñ—ó Interno.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–¥–∞—Ç–∏ —Å—Ç—Ä–∏–º–∞–Ω–∏–π, —Å—Ç—Ä–æ–≥–∏–π, —Ç–æ—á–Ω–∏–π —ñ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π —Ñ—ñ–¥–±–µ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä—É, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–≤ –Ω–∞ –∫–µ–π—Å —É –º–æ–¥—É–ª—ñ –∫—É—Ä—Å—É 


–¢–≤—ñ–π —Ñ—ñ–¥–±–µ–∫ –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∏–º–æ–≥–ª–∏–≤–∏–º —ñ –≥–ª–∏–±–æ–∫–∏–º.  
–ù–µ —Ç–æ–ª–µ—Ä—É–π "–∑–∞–≥–∞–ª—å–Ω—ñ", "—Å–æ–ª–æ–¥–∫—ñ", –Ω–µ—á—ñ—Ç–∫—ñ –∞–±–æ –Ω–µ–ø–æ–≤–Ω—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ.  
–û—Ü—ñ–Ω—é–π –≤—ñ–¥–ø–æ–≤—ñ–¥—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤–∏–∫–ª—é—á–Ω–æ –∑–∞ —Ä—ñ–≤–Ω–µ–º –ø—Ä–æ—Ñ–µ—Å—ñ–æ–Ω–∞–ª—ñ–∑–º—É, —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ—Å—Ç—ñ, –ø–æ–≤–Ω–æ—Ç–∏ —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ—Å—Ç—ñ —Ç–µ—Ö–Ω—ñ—Ü—ñ –ø—Ä–æ–¥–∞–∂—É.


[–û–ë–û–í'–Ø–ó–ö–û–í–û –í–†–ê–•–£–ô –°–¢–ê–ù–î–ê–†–¢–ò]
–ù–∏–∂—á–µ –ø–µ—Ä–µ–ª—ñ–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ –∫–æ–º–ø–∞–Ω—ñ—ó (—á–µ–∫-–ª–∏—Å—Ç). –ü–µ—Ä–µ–≤—ñ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–º—É –ø—É–Ω–∫—Ç—É.
–Ø–∫—â–æ —î –°–£–¢–¢–Ñ–í–Ü –ø–æ—Ä—É—à–µ–Ω–Ω—è (–±—É–¥—å-—è–∫–∏–π –∫—Ä–∏—Ç–∏—á–Ω–∏–π –ø—É–Ω–∫—Ç), —Ç–æ:
- "overall_score" –ù–ï –º–æ–∂–µ –±—É—Ç–∏ > 2.
- –£ "comment" –¥–æ–¥–∞–π –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª "‚ùó –ü–æ—Ä—É—à–µ–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤:" –∑ –∫–æ—Ä–æ—Ç–∫–∏–º –ø–µ—Ä–µ–ª—ñ–∫–æ–º –ø—É–Ω–∫—Ç—ñ–≤, —è–∫—ñ –ø–æ—Ä—É—à–µ–Ω–æ.
- –Ø–∫—â–æ –ø–æ—Ä—É—à–µ–Ω—å –Ω–µ–º–∞—î ‚Äî –¥–æ–¥–∞–π –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª "‚úÖ –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º: —Ç–∞–∫".

# üìå –î–û–î–ê–¢–ö–û–í–Ü –í–ò–ú–û–ì–ò –î–û –û–¶–Ü–ù–ö–ò:

1. –û—Ü—ñ–Ω—é–π –ö–û–ñ–ï–ù –µ–ª–µ–º–µ–Ω—Ç —Ç–µ—Ö–Ω—ñ–∫–∏ –û–ö–†–ï–ú–û. –Ø–∫—â–æ —É —Ç–µ—Ö–Ω—ñ—Ü—ñ 3 –∫—Ä–æ–∫–∏ ‚Äî –æ—Ü—ñ–Ω—é–π 3 –∫—Ä–æ–∫–∏.  
   - –Ø–∫—â–æ —Ö–æ—á–∞ –± 1 –∫—Ä–æ–∫ –≤–∏–∫–æ–Ω–∞–Ω–∏–π —Å–ª–∞–±–∫–æ ‚Üí —Ç–µ—Ö–Ω—ñ–∫–∞ –ù–ï –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é.  
   - –§—ñ–∫—Å—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ: —è–∫–∏–π –∫—Ä–æ–∫, —â–æ –±—É–ª–æ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –∞–±–æ –ø–æ–≤–µ—Ä—Ö–Ω–µ–≤–æ, —á–æ–≥–æ –±—Ä–∞–∫—É—î.

2. –û—Ü—ñ–Ω—é–π —Å—Ç—Ä–æ–≥—ñ—à–µ, –Ω—ñ–∂ –º–µ–Ω–µ–¥–∂–µ—Ä –æ—á—ñ–∫—É—î.  
   –í–∏—Å–æ–∫—É –æ—Ü—ñ–Ω–∫—É —Å—Ç–∞–≤ –ª–∏—à–µ —Ç–æ–¥—ñ, –∫–æ–ª–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å:  
   - —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç–∞,  
   - –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤–∞–Ω–∞,  
   - –ª–æ–≥—ñ—á–Ω–æ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–∞,  
   - –∑–≤—É—á–∏—Ç—å —è–∫ –ø—Ä–æ—Ñ–µ—Å—ñ–π–Ω–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç,  
   - –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ–¥–∞–∂—É (B2C / –ø—Ä–µ–º—ñ—É–º —Å–µ–≥–º–µ–Ω—Ç / furniture global sales best practices).

3. –í—Ä–∞—Ö–æ–≤—É–π —Å–≤—ñ—Ç–æ–≤—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏:  
   - –ø—Ä–æ–∑–æ—Ä–∞ –ª–æ–≥—ñ–∫–∞,  
   - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü—ñ—è –µ–∫—Å–ø–µ—Ä—Ç–∏–∑–∏,  
   - –º º—è–∫–µ –≤–µ–¥–µ–Ω–Ω—è,  
   - –Ω—É–ª—å —Ç–∏—Å–∫—É,  
   - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞ –∫–æ—Ä–∏—Å–Ω—ñ—Å—Ç—å,  
   - —Å–µ—Ä–≤—ñ—Å–Ω–∞ –ø–æ–∑–∏—Ü—ñ—è,  
   - –ø–æ—è—Å–Ω–µ–Ω–Ω—è —Ü—ñ–Ω–Ω–æ—Å—Ç—ñ, –∞ –Ω–µ –∑–∞—Ö–∏—Å—Ç.

4. –ù–µ –ø—Ä–∏–π–º–∞–π –∫–æ—Ä–æ—Ç–∫—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —è–∫ –¥–æ—Å—Ç–∞—Ç–Ω—ñ.  
   –Ø–∫—â–æ –≤—ñ–¥–ø–æ–≤—ñ–¥—å < 25 —Å–µ–∫—É–Ω–¥ –∞–±–æ –Ω–µ —Ä–æ–∑–∫—Ä–∏–≤–∞—î –¥—É–º–∫—É ‚Äî –∑–∞–∑–Ω–∞—á —Ü–µ —è–∫ –ø–æ–º–∏–ª–∫—É.

5. –ù–µ —Ö–≤–∞–ª–∏ –∑–∞–≥–∞–ª—å–Ω–æ.  
   –ö–æ–∂–Ω–∞ –ø–æ—Ö–≤–∞–ª–∞ –ø–æ–≤–∏–Ω–Ω–∞ –º—ñ—Å—Ç–∏—Ç–∏ —á—ñ—Ç–∫–∏–π —Ñ–∞–∫—Ç, —Ñ—Ä–∞–∑—É –∞–±–æ –µ–ª–µ–º–µ–Ω—Ç –ª–æ–≥—ñ–∫–∏.


   

–ß–µ–∫-–ª–∏—Å—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤:
${companyStandards}
`
    : '';

  if (isFirstMessage) {
    return `–í—ñ–∑—å–º–∏ —Ç–µ–∫—Å—Ç –ø—ñ—Å–ª—è —Å–ª–æ–≤–∞ "–ö–ï–ô–°:" —É —Ü—å–æ–º—É –æ–ø–∏—Å—ñ:
${slidePrompt}

–ü–æ–∫–∞–∂–∏ –π–æ–≥–æ –±–µ–∑ —Å–ª–æ–≤–∞ "–ö–ï–ô–°:" —ñ –±–µ–∑ –ª–∞–ø–æ–∫. 
–ù–µ –¥–æ–¥–∞–≤–∞–π –Ω—ñ—á–æ–≥–æ –≤—ñ–¥ —Å–µ–±–µ.`;
  }

  if (lastUserMessage?.text) {
    const studentAnswer = lastUserMessage.text;

    return `–û—Ü—ñ–Ω–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –∑–∞ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º–∏ –∑ —Ü—å–æ–≥–æ –æ–ø–∏—Å—É:
${slidePrompt}
${standardsInstruction}

–í—ñ–¥–ø–æ–≤—ñ–¥—å —Å—Ç—É–¥–µ–Ω—Ç–∞:
${studentAnswer}

–¢–µ–ø–µ—Ä –ø–æ–≤–µ—Ä–Ω–∏ –°–¢–†–û–ì–û –≤–∞–ª—ñ–¥–Ω–∏–π JSON –≤ –æ–¥–∏–Ω —Ä—è–¥–æ–∫ –±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å—ñ–≤ —Ä—è–¥–∫—ñ–≤, –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç—É. –§–æ—Ä–º–∞—Ç:

{
  "text": "–ø–æ–≤—Ç–æ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Å—Ç—É–¥–µ–Ω—Ç–∞",
  "rating": {
    "overall_score": <—á–∏—Å–ª–æ –≤—ñ–¥ 0 –¥–æ 5>,
    "criteriaScores": {
      "–¥–ª—è —Ç–æ–≥–æ —â–æ–± –∑—Ä–æ–∑—É–º—ñ—Ç–∏ —è–∫–∏–π –±—É–¥–µ –∫–ª—é—á –∑–Ω–∞–π—Ç–∏ –Ω–∞–∑–≤—É –∫—Ä–∏—Ç–µ—Ä–∏—é –≤ —Å–ø–∏—Å–∫—É ${criteriasText}, —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤—É –∫–ª—é—á": <–æ—Ü—ñ–Ω–∫–∞>,
      "...": <–æ—Ü—ñ–Ω–∫–∞>
    },
    "comment":"üìä –ó–ê–ì–ê–õ–¨–ù–ê –û–¶–Ü–ù–ö–ê: 4/5\\n\\nüéØ –û–¶–Ü–ù–ö–ê –ü–û –ö–†–ò–¢–ï–†–Ü–Ø–•:\\n‚Ä¢ –õ–æ–≥—ñ–∫–∞: 7\\n‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞: 8\\n\\nüí° –§–Ü–î–ë–ï–ö:\\n–¢—É—Ç –π–¥–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è...\\n\\n‚úÖ –°–ò–õ–¨–ù–Ü –°–¢–û–†–û–ù–ò:\\n...\\n\\nüîß –©–û –ü–û–ö–†–ê–©–ò–¢–ò:\\n...\\n\\nüöÄ –ù–ê–°–¢–£–ü–ù–ò–ô –ö–†–û–ö:\\n...${
      companyStandards
        ? '\\n\\n‚ùó –ü–æ—Ä—É—à–µ–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤:\\n(–ø–µ—Ä–µ—Ä–∞—Ö—É–π—Ç–µ –∞–±–æ –≤–∫–∞–∂—ñ—Ç—å: –≤—ñ–¥—Å—É—Ç–Ω—ñ)\\n\\n‚úÖ –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º: —Ç–∞–∫/–Ω—ñ'
        : ''
    }"
  }
}

‚ùó –î—É–∂–µ –≤–∞–∂–ª–∏–≤–æ: —Ü–µ –º–∞—î –±—É—Ç–∏ –û–î–ò–ù JSON-–æ–± º—î–∫—Ç, –±–µ–∑ –∑–∞–π–≤–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤.`;
  }

  return '';
}
