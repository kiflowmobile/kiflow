import { Message } from '@/src/constants/types/ai_chat';


export function buildPrompt(
  slidePrompt: string,
  isFirstMessage: boolean,
  lastUserMessage?: Message,
  criteriasText: string = '',
  companyStandards?: unknown,
): string {
  const standardsInstruction = companyStandards
    ? `
[–û–ë–û–í'–Ø–ó–ö–û–í–û –í–†–ê–•–£–ô –°–¢–ê–ù–î–ê–†–¢–ò]
–ù–∏–∂—á–µ –ø–µ—Ä–µ–ª—ñ–∫ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤ –∫–æ–º–ø–∞–Ω—ñ—ó (—á–µ–∫-–ª–∏—Å—Ç). –ü–µ—Ä–µ–≤—ñ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –∫–æ–∂–Ω–æ–º—É –ø—É–Ω–∫—Ç—É.
–Ø–∫—â–æ —î –°–£–¢–¢–Ñ–í–Ü –ø–æ—Ä—É—à–µ–Ω–Ω—è (–±—É–¥—å-—è–∫–∏–π –∫—Ä–∏—Ç–∏—á–Ω–∏–π –ø—É–Ω–∫—Ç), —Ç–æ:
- "overall_score" –ù–ï –º–æ–∂–µ –±—É—Ç–∏ > 2.
- –£ "comment" –¥–æ–¥–∞–π –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª "‚ùó –ü–æ—Ä—É—à–µ–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤:" –∑ –∫–æ—Ä–æ—Ç–∫–∏–º –ø–µ—Ä–µ–ª—ñ–∫–æ–º –ø—É–Ω–∫—Ç—ñ–≤, —è–∫—ñ –ø–æ—Ä—É—à–µ–Ω–æ.
- –Ø–∫—â–æ –ø–æ—Ä—É—à–µ–Ω—å –Ω–µ–º–∞—î ‚Äî –¥–æ–¥–∞–π –ø—ñ–¥—Ä–æ–∑–¥—ñ–ª "‚úÖ –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º: —Ç–∞–∫".

–ß–µ–∫-–ª–∏—Å—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤:
${companyStandards}
`
    : '';

  if (isFirstMessage) {
    return `–í—ñ–∑—å–º–∏ —Ç–µ–∫—Å—Ç –ø—ñ—Å–ª—è —Å–ª–æ–≤–∞ "–ö–ï–ô–°:" —É —Ü—å–æ–º—É –æ–ø–∏—Å—ñ:
${slidePrompt}

–ü–æ–∫–∞–∂–∏ –π–æ–≥–æ –±–µ–∑ —Å–ª–æ–≤–∞ "–ö–ï–ô–°:" —ñ –±–µ–∑ –ª–∞–ø–æ–∫. 
–ù–µ –¥–æ–¥–∞–≤–∞–π –Ω—ñ—á–æ–≥–æ –≤—ñ–¥ —Å–µ–±–µ.`;
  }

  if (lastUserMessage?.text) {
    const studentAnswer = lastUserMessage.text;

    return `–û—Ü—ñ–Ω–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—å —Å—Ç—É–¥–µ–Ω—Ç–∞ –∑–∞ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º–∏ –∑ —Ü—å–æ–≥–æ –æ–ø–∏—Å—É:
${slidePrompt}
${standardsInstruction}

–í—ñ–¥–ø–æ–≤—ñ–¥—å —Å—Ç—É–¥–µ–Ω—Ç–∞:
${studentAnswer}

–¢–µ–ø–µ—Ä –ø–æ–≤–µ—Ä–Ω–∏ –°–¢–†–û–ì–û –≤–∞–ª—ñ–¥–Ω–∏–π JSON –≤ –æ–¥–∏–Ω —Ä—è–¥–æ–∫ –±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å—ñ–≤ —Ä—è–¥–∫—ñ–≤, –±–µ–∑ –¥–æ–¥–∞—Ç–∫–æ–≤–æ–≥–æ —Ç–µ–∫—Å—Ç—É. –§–æ—Ä–º–∞—Ç:

{
  "text": "–ø–æ–≤—Ç–æ—Ä –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ —Å—Ç—É–¥–µ–Ω—Ç–∞",
  "rating": {
    "overall_score": <—á–∏—Å–ª–æ –≤—ñ–¥ 0 –¥–æ 5>,
    "criteriaScores": {
      "–¥–ª—è —Ç–æ–≥–æ —â–æ–± –∑—Ä–æ–∑—É–º—ñ—Ç–∏ —è–∫–∏–π –±—É–¥–µ –∫–ª—é—á –∑–Ω–∞–π—Ç–∏ –Ω–∞–∑–≤—É –∫—Ä–∏—Ç–µ—Ä–∏—é –≤ —Å–ø–∏—Å–∫—É ${criteriasText}, —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤—É –∫–ª—é—á": <–æ—Ü—ñ–Ω–∫–∞>,
      "...": <–æ—Ü—ñ–Ω–∫–∞>
    },
    "comment":"üìä –ó–ê–ì–ê–õ–¨–ù–ê –û–¶–Ü–ù–ö–ê: 4/5\\n\\nüéØ –û–¶–Ü–ù–ö–ê –ü–û –ö–†–ò–¢–ï–†–Ü–Ø–•:\\n‚Ä¢ –õ–æ–≥—ñ–∫–∞: 7\\n‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∞: 8\\n\\nüí° –§–Ü–î–ë–ï–ö:\\n–¢—É—Ç –π–¥–µ –ø–æ—è—Å–Ω–µ–Ω–Ω—è...\\n\\n‚úÖ –°–ò–õ–¨–ù–Ü –°–¢–û–†–û–ù–ò:\\n...\\n\\nüîß –©–û –ü–û–ö–†–ê–©–ò–¢–ò:\\n...\\n\\nüöÄ –ù–ê–°–¢–£–ü–ù–ò–ô –ö–†–û–ö:\\n...${
      companyStandards
        ? '\\n\\n‚ùó –ü–æ—Ä—É—à–µ–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ñ–≤:\\n(–ø–µ—Ä–µ—Ä–∞—Ö—É–π—Ç–µ –∞–±–æ –≤–∫–∞–∂—ñ—Ç—å: –≤—ñ–¥—Å—É—Ç–Ω—ñ)\\n\\n‚úÖ –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º: —Ç–∞–∫/–Ω—ñ'
        : ''
    }"
  }
}

‚ùó –î—É–∂–µ –≤–∞–∂–ª–∏–≤–æ: —Ü–µ –º–∞—î –±—É—Ç–∏ –û–î–ò–ù JSON-–æ–± º—î–∫—Ç, –±–µ–∑ –∑–∞–π–≤–∏—Ö —Å–∏–º–≤–æ–ª—ñ–≤.`;
  }

  return '';
}
